<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/ButterswapRouter.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> ButterswapRouter.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">60% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>18/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">30% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>6/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">75% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>6/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">66.67% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>26/39</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
pragma solidity ^0.8.0;
pragma experimental ABIEncoderV2;
&nbsp;
import "./interface/IERC20.sol";
import "./libs/TransferHelper.sol";
import "./libs/SafeMath.sol";
import "./interface/ISwap.sol";
import "./interface/IWETH9.sol";
import "./interface/IButterswapV2Router01.sol";
&nbsp;
&nbsp;
contract ButterswapRouterV1  {
&nbsp;
    using SafeMath for uint;
    address public feeToAdmin; 
    mapping(uint256 =&gt; address) public routerAddreAll;
   
&nbsp;
   struct AccessParams {
        uint256[]  amountInArr;  
        uint256[]  amountOutMinArr;
        bytes[]    pathArr;
        address  payable  to; 
        uint256    deadLine; 
        address[]  input_Out_Addre;  // 0 -input  1- Out
        uint256[]  routerIndex; 
        address[9][2] crv_Route;
        uint256[3][4] crv_Swap_Params;
        uint256       crv_Expected;
                     
    } 
    
&nbsp;
     receive() external payable { 
    }
 
&nbsp;
    modifier onlyOwner() {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == feeToAdmin,"ButterswapV2Router: EXPIRED");
        _;
    }
&nbsp;
    constructor(address _feeToAdmin) {
        feeToAdmin = _feeToAdmin;
    }
&nbsp;
    
&nbsp;
    function multiSwap (AccessParams calldata params) external payable {    
            uint256 amountInArrs = getAmountInAll(params.amountInArr);
            <span class="missing-if-branch" title="if path not taken" >I</span>if(params.input_Out_Addre[0] == address(0)){
<span class="cstat-no" title="statement not covered" >                require(msg.value == amountInArrs,"Price is wrong")</span>;
            }else{ 
                TransferHelper.safeTransferFrom(params.input_Out_Addre[0],msg.sender,address(this),amountInArrs);
            }
            
            for(uint i = 0; i &lt; params.routerIndex.length; i++){
                address rindex = routerAddreAll[params.routerIndex[i]];
                <span class="missing-if-branch" title="else path not taken" >E</span>if (i == 0  &amp;&amp; params.crv_Expected != 0){ 
                    crvSwap(params.input_Out_Addre[0],rindex,params.crv_Route,params.crv_Swap_Params,params.amountInArr[i],params.crv_Expected,params.to);
                }else{
<span class="cstat-no" title="statement not covered" >                    ammSeriSwap(rindex,params.amountInArr[i],params.amountOutMinArr[i],params.pathArr[i],params.to,params.deadLine,params.input_Out_Addre[0],params.input_Out_Addre[1])</span>;                  
                    }
                }
            }
&nbsp;
&nbsp;
    // crv
    function crvSwap(address _inputAddre,address  _rindex, address[9][2] memory _route,uint256[3][4] memory _swap_params,uint256 _amount, uint256 expected,address _to) internal{
        
        address[4] memory pools;                
        pools[0] = _route[1][0];
        pools[1] = _route[1][1];
        pools[2] = _route[1][2];
        pools[3] = _route[1][3];
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if(_inputAddre == address(0)){
<span class="cstat-no" title="statement not covered" >             TransferHelper.safeTransferETH(_rindex,_amount)</span>;   
<span class="cstat-no" title="statement not covered" >             ISwap(_rindex).filterCurve(_inputAddre,_route[0],_swap_params,_amount,expected,pools,_to)</span>;
         }else{
             TransferHelper.safeApprove(_inputAddre,_rindex,_amount);
            TransferHelper.safeTransfer(_inputAddre,_rindex,_amount);
            ISwap(_rindex).filterCurve(_inputAddre,_route[0],_swap_params,_amount,expected,pools,_to);
         } 
    }
&nbsp;
&nbsp;
    // uni kind
<span class="fstat-no" title="function not covered" >    function ammSeriSwap(address _rindex,uint256 _amount,uint256 _amountOutMinArr,bytes memory _pathArr,address _to,uint256 _deadLine,address _inputAddre,address _outAddre) internal {</span>
<span class="cstat-no" title="statement not covered" >            if(_inputAddre == address(0)){</span>
<span class="cstat-no" title="statement not covered" >                    TransferHelper.safeTransferETH(_rindex,_amount)</span>;
<span class="cstat-no" title="statement not covered" >                    ISwap(_rindex).filterSwap(_amount,_amountOutMinArr,_pathArr,_to,_deadLine,_inputAddre,_outAddre)</span>;      
                }else{
<span class="cstat-no" title="statement not covered" >                    TransferHelper.safeApprove(_inputAddre,_rindex,_amount)</span>;
<span class="cstat-no" title="statement not covered" >                    TransferHelper.safeTransfer(_inputAddre,_rindex,_amount)</span>;
<span class="cstat-no" title="statement not covered" >                    ISwap(_rindex).filterSwap(_amount,_amountOutMinArr,_pathArr,_to,_deadLine,_inputAddre,_outAddre)</span>;     
                }
    }
&nbsp;
    
    // amountInArr
    function getAmountInAll(uint256[] memory  amountInArr) public pure  returns(uint256 ){
        uint256 amountInArrs;
        for(uint256 i = 0; i &lt; amountInArr.length; i++){
            amountInArrs += amountInArr[i];
        }
        return amountInArrs;
    }
&nbsp;
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function setFeeToSetter(address _feetoAdmin) public onlyOwner returns(bool) {</span>
<span class="cstat-no" title="statement not covered" >         require(_feetoAdmin != address(0), 'Butterswap: FORBIDDEN')</span>;
        feeToAdmin = _feetoAdmin;
<span class="cstat-no" title="statement not covered" >        return true;</span>
    }
    
&nbsp;
&nbsp;
    function setRouterAddreAll(uint256 index ,address _routeraddre) public <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner returns(bool){
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_routeraddre != address(0),'Butterswap: FORBIDDEN');
        routerAddreAll[index] = _routeraddre;
        return true;
    }
&nbsp;
&nbsp;
  
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Nov 30 2022 18:08:18 GMT+0800 (中国标准时间)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
